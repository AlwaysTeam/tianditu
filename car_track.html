<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="./images/favicon.ico" />
    <title>天地图－车辆轨迹</title>
    <script
      src="https://api.tianditu.gov.cn/api?v=4.0&tk=5371db494093d4275fa330692637c9f6"
      type="text/javascript"
    ></script>
    <script src="./js/d3.min.js" charset="utf-8"></script>
    <script src="./js/D3SvgOverlay.js"></script>
    <script src="./js/CarTrack.js"></script>
    <script src="./js/point.js"></script>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      .container {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      #mapDiv {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div>
        <input type="button" value="开始" onClick="_CarTrack.start();" />
        <input type="button" value="暂停" onClick="_CarTrack.pause();" />
        <input type="button" value="结束" onClick="_CarTrack.stop();" />
      </div>
      <div id="mapDiv"></div>
    </div>
    <script>
      var map = new T.Map("mapDiv", {
        minZoom: 14,
        maxZoom: 14,
        center: new T.LngLat(116.31809, 39.92027),
        zoom: 14,
      });
      map.disableDrag();
      var _CarTrack = new T.CarTrack(map, {
        interval: 5, // 从当前节点到下一节点的时间间隔。
        speed: 10, // 一个时间间隔移动的距离，单位是米。 注：speed为0时，按照Datas数组中每个元素的坐标移动。
        dynamicLine: false, // 为true时轨迹线随车移动，而变化。 false时，车辆运动轨迹提前画好且无动态变化。
        polylinestyle: { color: "#2C64A7", weight: 5, opacity: 0.9 }, // 车辆轨迹线样式。
        carstyle: { display: true, iconUrl: "./images/car.png", width: 52, height: 26 }, // 车辆样式，
        Datas: datas.features.map(function (obj, i) {
          var coordinates = obj.geometry.coordinates;
          var lnlat = new T.LngLat(coordinates[0], coordinates[1]);
          return lnlat;
        }), // 数据来源。
        passOneNode: (lnglat, index, length) => {
          if (index === length) {
            _CarTrack.pause();
          }
        }, // 车辆移动一次时触发调用的方法 Lnglat：经过的坐标 index：节点序号。 length:总节点数量。
      });
    </script>
  </body>
</html>
